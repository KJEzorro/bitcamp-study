<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>음식점 등록</title>
</head>

<body>
  <h1>음식점 상세정보</h1>
  <form>
    분류: <input id="x-category" type="text"><br>
    이름*: <input id="x-name" type="text" readonly><br>
    대표메뉴: <input id="x-menu" type="text"><br>
    전화번호*: <input id="x-tel" type="text" readonly><br>
    별표(*) 항목은 필수 입력입니다.<br>
    <button id="x-update-btn" type="button">변경</button>
    <button id="x-delete-btn" type="button">삭제</button>
    <button id="x-cancel-btn" type="button">취소</button>
  </form>

  <script>
    var arr = location.href.split("?")
    console.log(arr);

    if (arr.length == 1) {
      alert("요청한 형식이 올바르지 않습니다.")
      throw "URL 형식 오류"
    }

    var qs = arr[1]
    console.log(qs);

    var params = new URLSearchParams(qs)
    var tel = params.get("tel")


    if (tel == null) {
      alert("전화번호가 등록되어있지 않습니다.")
      throw "parameter error"
    }
    console.log(tel);

    var xCategory = document.querySelector("#x-category")
    var xName = document.querySelector("#x-name")
    var xMenu = document.querySelector("#x-menu")
    var xTel = document.querySelector("#x-tel")

    fetch(`/my1/get?tel=${tel}`)
      .then(function(response) {
        return response.text()
      })
      .then(function(result) {
        var values = result.split(",")

        xCategory.value = values[0]
        xName.value = values[1]
        xMenu.value = values[2]
        xTel.value = values[3]
      })

    document.querySelector("#x-update-btn").onclick = function() {
      if (xName.value == "" || xTel.value == "") {
        alert("필수입력 항목 작성해주세요.")
        return
      }

      fetch(`/my1/update?category=${xCategory.value}&name=${xName.value}&menu=${xMenu.value}&tel=${xTel.value}`)
        .then(function(response) {
          return response.text()
        })
        .then(function(result) {
          console.log(result);
          location.href = "index.html"
        })
    }

    document.querySelector("#x-cancel-btn").onclick = function() {
      location.href = "index.html"
    }

    document.querySelector("#x-delete-btn").onclick = function() {
    fetch(`/my1/delete?tel=${tel}`)
      .then(function(response) {
        return response.json();
      })
      .then(function(result) {
        console.log(result);
        location.href = "index.html";
      });
  };
  </script>


</body>

</html>
